<?//require_once $_SERVER['DOCUMENT_ROOT'].'/wp-blog-header.php';require_once $_SERVER['DOCUMENT_ROOT'].'/wp-load.php';global $woocommerce;session_start();$action     = $_REQUEST['act'];$product_id = $_REQUEST['product_id'];$quantity   = $_REQUEST['quantity'];$cart_key   = $_REQUEST['cart_key'];$extra      = $_REQUEST['extra'];//echo $woocommerce->cart->add_to_cart( 10632, 1 );switch ($action){    case 'add':        $woocommerce->cart->add_to_cart( $product_id, $quantity );        break;    case 'clear':        if($woocommerce->cart->empty_cart()) echo 'done';        else echo 'clear_error';        break;    case 'get_items':        $items = $woocommerce->cart->get_cart();        return $items;        break;    case 'update':        if($cart_key){            $woocommerce->cart->set_quantity($cart_key, $quantity);            $total = $woocommerce->cart->get_cart_total();            $total = price_format($total);            echo $total;        }else{            $items = $woocommerce->cart->get_cart();            foreach ($items as $key => $item){                if($product_id == $item['product_id']) $woocommerce->cart->set_quantity($key, $quantity);            }        }        break;    case 'add_extra':        //Удаляем существующие услуги для товара        if($_SESSION['extra'][$product_id]){            $extra_items = explode(',', $_SESSION['extra'][$product_id]);            $items = $woocommerce->cart->get_cart();            foreach ($items as $key => $item){                foreach ($extra_items as $id){                    if($item['product_id'] == $id) $woocommerce->cart->set_quantity($key, 0);                }            }        }        if($extra == '') unset($_SESSION['extra'][$product_id]);        else $_SESSION['extra'][$product_id] = $extra;        //Добавляем услуги товару        $extra = explode(',', $extra);        foreach ($extra as $id){            $woocommerce->cart->add_to_cart( $id, 1);        }        break;    default:        echo "unknown action";}//$woocommerce->cart->set_quantity('106fac81e07001e1825eadbb39fcde11', 12);//$items = $woocommerce->cart->get_cart();//$total = $woocommerce->cart->get_total();/*$memorials = [50, 57, 743, 332, 59];foreach ($items as $item) {    $category = get_the_terms( $item['product_id'], 'product_cat' );   /* if($category[0]['parent'] > 0) $cat_id = $category[0]['parent'];    else $cat_id = $category[0]['term_id'];*/    //if(in_array($cat_id, $memorials))    //echo "<pre>".print_r($category[0]->parent, 1)."</pre>";//}//echo "<pre>".print_r($total, 1)."</pre>";//echo 'ajax';?>